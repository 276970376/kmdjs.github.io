<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>

    <!-- vertex shader -->
    <script id="2d-vertex-shader" type="x-shader/x-vertex">
        attribute vec2 a_position;
        attribute vec2 a_texCoord;

        varying vec2 v_texCoord;
        void main() {

           gl_Position = pMatrix* vec4(a_position, 0, 1);

           // pass the texCoord to the fragment shader
           // The GPU will interpolate this value between points.
           v_texCoord = a_texCoord;
        }
    </script>
    <!-- fragment shader -->
    <script id="2d-fragment-shader" type="x-shader/x-fragment">
        precision mediump float;

        // our texture
        uniform sampler2D u_image;

        // the texCoords passed in from the vertex shader.
        varying vec2 v_texCoord;
        //注入glsl
        uniform float angle;
        const float radius = 0.5;
        void main() {
            vec2 center = vec2(0.5, 0.5);
            vec2 tex = v_texCoord;
            float dist = distance(center, v_texCoord);
            tex -= center;
            if (dist < radius)
            {
                 float percent = (radius - dist) / radius;
                 float theta = percent * percent * angle * 8.0;
                 float s = sin(theta);
                 float c = cos(theta);
                 tex = vec2(dot(tex, vec2(c, -s)), dot(tex, vec2(s, c)));
            }
            tex += center;
           gl_FragColor = texture2D(u_image, tex);
        }
    </script>
</head>
<body>
    <canvas id="canvas" width="960" height="800"></canvas>
    <script src="resources/egl.js"></script>
    <script>
        ; (function () {
            var angle = 0,img;
            var gl = egl("#canvas", "2d-vertex-shader", "2d-fragment-shader");

            gl.loadImage("resources/test.jpg", function (image) {
                    render(image)
            })

            function render(image) {
               
                gl.clear();

                gl.texture(image);

                angle += Math.PI / 180;
                gl.uniform("angle", angle);
                //顶点坐标
                var width = image.width, height = image.height;
                var x1 = 0;
                var x2 = x1 + width;
                var y1 = 0;
                var y2 = y1 + height;
                gl.buffer("a_position", [
                   x1, y1,
                   x2, y1,
                   x1, y2,
                   x2, y2]);

                //用来填充三角形的纹理区域
                gl.buffer("a_texCoord", [
                        0.0, 0.0,
                        1.0, 0.0,
                        0.0, 1.0,
                        1.0, 1.0]);

                // Draw the rectangle.
                gl.draw();

                requestAnimationFrame(function () {
                    render(image)
                })
            }
        })();
       
        



    </script>
</body>
</html>
//纹理只给url的问题，egl内部cache和管理